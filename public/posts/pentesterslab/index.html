<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible"
      content="IE=edge">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0" />
<meta name="description"
      content="Adventures of Functional Mediocrity" />
<meta name="keywords"
      content="zola, theme, ink, hugo-ink" /> 

<title>John Tuyen | Code Review Adventures</title>
<meta
  property="og:title"
  content="John Tuyen | Code Review Adventures"
/>
<meta property="og:type" content="website" />
<meta property="og:url" content="https://johntuyen.com/posts/pentesterslab/" />
<meta property="og:description" content="Notes from Pentester&#x27;s Lab" />
<meta property="og:image" content="" />
<meta property="og:image:url" content="" />
<meta property="og:image:secure_url" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Code Review Adventures" />
<meta name="twitter:description" content="Notes from Pentester&#x27;s Lab" />
<meta property="twitter:image" content="" />

<link rel="alternate"
          type="application/rss+xml"
          title="John Tuyen"
          href="https://johntuyen.com/atom.xml">
    <link rel="preconnect"
          href="https://fonts.googleapis.com">
    <link rel="preconnect"
          href="https://fonts.gstatic.com"
          crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">  -->
    <link href="https://fonts.googleapis.com/css2?family=Andada+Pro&display=swap&family=Playfair+Display"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://johntuyen.com/base.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js"
            integrity="sha512-7x3zila4t2qNycrtZ31HO0NnJr8kg2VI67YLoRSyi9hGhRN66FHYWr7Axa9Y1J9tGYHVBPqIjSE1ogHrJTz51g=="
            crossorigin="anonymous"></script>
</head>

<body>
    <header>
        <a class="site-name"
           href="/">
            <h1>John Tuyen</h1>
        </a>
        <div class="site-description">
            <p>Adventures of Functional Mediocrity</p>
        </div>
        <nav>
            <div class="links"> 
            <a 
                href="https://johntuyen.com/ ">About</a> 
            <a 
                href="https://johntuyen.com/posts/ ">Posts</a> 
            <a 
                href="https://johntuyen.com/gallery/ ">Gallery</a> 
            <a 
                href="https://johntuyen.com/tags/ ">Tags</a> 
            <a 
                href="https://johntuyen.com/search/ ">Search</a> 
            </div>
        </nav>
    </header>
    <article>
    

<section class="post">
  <div class="post-header">
    <div class="meta">
      <div class="date">
        <span class="day">09</span>
        <span class="rest">Jul 22</span>
      </div>
    </div>

    <div class="matter">
      <h1 class="title">Code Review Adventures </h1>
    </div>
  </div>
    
  <article><h2 id="python-01">Python 01</h2>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>hashlib
</span><span style="color:#b48ead;">from </span><span>flask </span><span style="color:#b48ead;">import </span><span>Flask,redirect
</span><span style="color:#b48ead;">from </span><span>secrets </span><span style="color:#b48ead;">import </span><span>token_hex
</span><span>secret = &quot;</span><span style="color:#a3be8c;">[....]</span><span>&quot;
</span><span>app = </span><span style="color:#bf616a;">Flask</span><span>(__name__)
</span><span> 
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">sign_for_payment</span><span>(</span><span style="color:#bf616a;">payment_information</span><span>):
</span><span>  </span><span style="color:#65737e;"># compute signature to ensure the payment details
</span><span>  </span><span style="color:#65737e;"># cannot be tampered with
</span><span>  data = secret+payment_information
</span><span>  </span><span style="color:#b48ead;">return </span><span>hashlib.</span><span style="color:#bf616a;">sha256</span><span>(data.</span><span style="color:#bf616a;">encode</span><span>(&#39;</span><span style="color:#a3be8c;">utf-8</span><span>&#39;)).</span><span style="color:#bf616a;">hexdigest</span><span>()
</span><span>  
</span><span>@app.</span><span style="color:#bf616a;">route</span><span>(&#39;</span><span style="color:#a3be8c;">/redirect_for_payment</span><span>&#39;)
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">redirect_for_payment</span><span>():
</span><span>    tx_id = </span><span style="color:#bf616a;">token_hex</span><span>(</span><span style="color:#d08770;">16</span><span>) 
</span><span>    payment_info = &quot;</span><span style="color:#a3be8c;">transaction_id=</span><span>&quot;+tx_id+&quot;</span><span style="color:#a3be8c;">&amp;amount=20.00</span><span>&quot;
</span><span>    params =payment_info+&quot;</span><span style="color:#a3be8c;">&amp;sign=</span><span>&quot;+</span><span style="color:#bf616a;">sign_for_payment</span><span>(payment_info)
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">redirect</span><span>(&quot;</span><span style="color:#a3be8c;">https://pentesterlab.com/payment?</span><span>&quot;+params, </span><span style="color:#bf616a;">code</span><span>=</span><span style="color:#d08770;">302</span><span>)
</span></code></pre>
<p>This code snippet is an example of cryptographic flaw of using sha2 as a hashing algorithm. SHA2 is susceptible to an attacked called <a href="https://en.wikipedia.org/wiki/Length_extension_attack">length extension</a>. A length extension attack can allow an attacker to use a Hash and the length of the message and extend the message. In the example code snippet, the <code>sign_for_payment</code> function is using SHA2 to encode the hash and the <code>redirect_for_payment</code> function will use it to sign payment information as a validation control measure. The weakness in this code snippet is found in the <code>payment_info</code> variable of which the <code>amount</code> is concatenated before encoding into hex format. By appending a duplicate <code>amount</code> parameter with a nafarious value assigned, it would overwrite the initial float amount ($20). This is possible because with length extension attacks, an attacker knows the state of the hashed key and messaging pair up to the point of appending a duplicate <code>amount</code> parameter. It is then trivial to figure out the hashing algorithm used and generate a new hash digest. The new forged hash digest will be sent back to the server as a valid request because the signature being the same length as the original. Hence why there is no need to know the original key to sign the message and the forged hash digest is accepted as if the password was known. </p>
<h2 id="python-02">Python 02</h2>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>urllib
</span><span style="color:#b48ead;">import </span><span>os
</span><span style="color:#b48ead;">from </span><span>flask </span><span style="color:#b48ead;">import </span><span>Flask,redirect,request
</span><span style="color:#b48ead;">from </span><span>secrets </span><span style="color:#b48ead;">import </span><span>token_hex
</span><span>app = </span><span style="color:#bf616a;">Flask</span><span>(__name__)
</span><span> 
</span><span>@app.</span><span style="color:#bf616a;">route</span><span>(&#39;</span><span style="color:#a3be8c;">/fetch</span><span>&#39;)
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">fetch</span><span>():
</span><span>    url = request.args.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">url</span><span>&#39;, &#39;&#39;)
</span><span>    </span><span style="color:#b48ead;">if </span><span>url.</span><span style="color:#bf616a;">startswith</span><span>(&quot;</span><span style="color:#a3be8c;">https://vulndomain.com</span><span>&quot;):
</span><span>      response = urllib.request.</span><span style="color:#bf616a;">urlopen</span><span>(url)
</span><span>      html = response.</span><span style="color:#bf616a;">read</span><span>()
</span><span>      </span><span style="color:#b48ead;">return </span><span>html
</span><span>    </span><span style="color:#b48ead;">return </span><span>&quot;&quot;
</span></code></pre>
<p>This code review snippet is an example of why URLs should be ended in a <code>/</code>. Without the <code>/</code>, a malicious attacker can register a nefarious top level domain that could bypass the filter by creating a subdomain such as <code>vulndomain.com.evildomain.com</code>. This flaw is called a server side request forgery (SSRF) as in the line where <code>response.read()</code> is found, the server will read the request and return the response value. This flaw can be leveraged by fetching data from malicious endpoints and have the server parse the information.</p>
<h2 id="python-03">Python 03</h2>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span>	</span><span style="color:#b48ead;">from </span><span>http.server </span><span style="color:#b48ead;">import </span><span>BaseHTTPRequestHandler, HTTPServer
</span><span style="color:#b48ead;">from </span><span>http.cookies </span><span style="color:#b48ead;">import </span><span>SimpleCookie
</span><span style="color:#b48ead;">import </span><span>base64
</span><span style="color:#b48ead;">import </span><span>pickle
</span><span> 
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">MyServer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BaseHTTPRequestHandler</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">do_GET</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>      cookies = </span><span style="color:#bf616a;">SimpleCookie</span><span>(</span><span style="color:#bf616a;">self</span><span>.headers.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">Cookie</span><span>&#39;))
</span><span>      </span><span style="color:#b48ead;">if </span><span>cookies.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">username</span><span>&#39;):
</span><span>        username=pickle.</span><span style="color:#bf616a;">loads</span><span>(base64.</span><span style="color:#bf616a;">b64decode</span><span>(cookies.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">username</span><span>&#39;).value))
</span><span>      </span><span style="color:#b48ead;">else</span><span>:
</span><span>        username=&#39;</span><span style="color:#a3be8c;">stranger</span><span>&#39;
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_response</span><span>(</span><span style="color:#d08770;">200</span><span>)
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_header</span><span>(&quot;</span><span style="color:#a3be8c;">Content-type</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">text/html</span><span>&quot;)
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">end_headers</span><span>()
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;body&gt;</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;h1&gt;Hello </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">&lt;/h1&gt;</span><span>&quot; % username, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;/body&gt;&lt;/html&gt;</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span> 
</span><span style="color:#b48ead;">if </span><span>__name__ == &quot;</span><span style="color:#a3be8c;">__main__</span><span>&quot;:
</span><span>    webServer = </span><span style="color:#bf616a;">HTTPServer</span><span>((&#39;</span><span style="color:#a3be8c;">0.0.0.0</span><span>&#39;, </span><span style="color:#d08770;">1337</span><span>), MyServer)
</span><span> 
</span><span>    </span><span style="color:#b48ead;">try</span><span>:
</span><span>        webServer.</span><span style="color:#bf616a;">serve_forever</span><span>()
</span><span>    </span><span style="color:#b48ead;">except </span><span>KeyboardInterrupt:
</span><span>        </span><span style="color:#b48ead;">pass
</span><span> 
</span><span>    webServer.</span><span style="color:#bf616a;">server_close</span><span>()
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">Server stopped.</span><span>&quot;)
</span></code></pre>
<p>The weakness in this python source code can be found in the <code>pickle.loads</code> method. Pickle is a python module that is used for serializing and deserializing data. Data serialization is a process to convert a state of data object into a byte stream such as the following commonly used formats: JSON, YAML, and XML. Data deserialization is the reverse process where the byte stream is recreated into an object stored in memory. In the code snippet, the cookie is fetched from HTTP headers and reads the cookie value from the <code>username</code> attribute. This can pose an issue as a cookie can be easily manipulated as a malicious source of data for the server to be read from. As displayed in the example of <code>pickle.loads</code>, the module deserializes the <code>username</code> cookie value using <code>base64.b64decode</code> method. Further research shows that a directive called <code>reduce</code> can be used to create a malicious serialized object. In theory, if a serialized object is encoded into a base64 payload into the cookie value, the HTTP server would know how to deserialize it using base64 decode function.</p>
<h2 id="python-04">Python 04</h2>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>http.server </span><span style="color:#b48ead;">import </span><span>BaseHTTPRequestHandler, HTTPServer
</span><span style="color:#b48ead;">from </span><span>http.cookies </span><span style="color:#b48ead;">import </span><span>SimpleCookie
</span><span> 
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">MyServer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BaseHTTPRequestHandler</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">do_GET</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>      cookies = </span><span style="color:#bf616a;">SimpleCookie</span><span>(</span><span style="color:#bf616a;">self</span><span>.headers.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">Cookie</span><span>&#39;))
</span><span>      </span><span style="color:#b48ead;">if </span><span>cookies.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">session_id</span><span>&#39;):
</span><span>        username=</span><span style="color:#96b5b4;">open</span><span>(cookies.</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">session_id</span><span>&#39;).value).</span><span style="color:#bf616a;">readlines</span><span>()[</span><span style="color:#d08770;">0</span><span>] 
</span><span>      </span><span style="color:#b48ead;">else</span><span>:
</span><span>        username=&#39;</span><span style="color:#a3be8c;">stranger</span><span>&#39;
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_response</span><span>(</span><span style="color:#d08770;">200</span><span>)
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_header</span><span>(&quot;</span><span style="color:#a3be8c;">Content-type</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">text/html</span><span>&quot;)
</span><span>      </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">end_headers</span><span>()
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;body&gt;</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;h1&gt;Hello </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">&lt;/h1&gt;</span><span>&quot; % username, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span>      </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">bytes</span><span>(&quot;</span><span style="color:#a3be8c;">&lt;/body&gt;&lt;/html&gt;</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">utf-8</span><span>&quot;))
</span><span> 
</span><span style="color:#b48ead;">if </span><span>__name__ == &quot;</span><span style="color:#a3be8c;">__main__</span><span>&quot;:
</span><span>    webServer = </span><span style="color:#bf616a;">HTTPServer</span><span>((&#39;</span><span style="color:#a3be8c;">0.0.0.0</span><span>&#39;, </span><span style="color:#d08770;">1337</span><span>), MyServer)
</span><span> 
</span><span>    </span><span style="color:#b48ead;">try</span><span>:
</span><span>        webServer.</span><span style="color:#bf616a;">serve_forever</span><span>()
</span><span>    </span><span style="color:#b48ead;">except </span><span>KeyboardInterrupt:
</span><span>        </span><span style="color:#b48ead;">pass
</span><span> 
</span><span>    webServer.</span><span style="color:#bf616a;">server_close</span><span>()
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">Server stopped.</span><span>&quot;)
</span></code></pre>
<p>The weakness in the code snippet can be found when the cookie <code>session_id</code> value is read by using <code>open</code> method. The cookie can act as a source of malicious input and by modifying the cookie value contained in <code>session_id</code>, the <code>open</code> method can be vulnerable if validation of the input is not performed. Python's <code>open</code> method is designed to open a file and read the file line by line. Knowing this fact, if the cookie value input contains a directory traversal path such as <code>../../file.txt</code> the <code>open</code> method will read the contents as such. A sample output can be seen like this:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">~</span><span> curl</span><span style="color:#bf616a;"> -b </span><span>&#39;</span><span style="color:#a3be8c;">session_id=key.txt</span><span>&#39; http://localhost:1337
</span><span>&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Hello </span><span style="color:#bf616a;">key</span><span> read
</span><span>&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;%
</span></code></pre>
<h2 id="python-05">Python 05</h2>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_post</span><span>(</span><span style="color:#bf616a;">post_id</span><span>):
</span><span>    conn = </span><span style="color:#bf616a;">get_db_connection</span><span>()
</span><span>    num_format = re.</span><span style="color:#bf616a;">compile</span><span>(</span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#b48ead;">^</span><span style="color:#d08770;">\d</span><span>+</span><span style="color:#b48ead;">$</span><span>&#39;, re.M)
</span><span>    </span><span style="color:#b48ead;">if </span><span>re.</span><span style="color:#bf616a;">match</span><span>(num_format,post_id):
</span><span>      post = conn.</span><span style="color:#bf616a;">execute</span><span>(&#39;</span><span style="color:#b48ead;">SELECT </span><span style="color:#bf616a;">* </span><span style="color:#b48ead;">FROM</span><span style="color:#a3be8c;"> posts </span><span style="color:#b48ead;">WHERE</span><span style="color:#a3be8c;"> id </span><span>= &#39;+post_id).</span><span style="color:#bf616a;">fetchone</span><span>()
</span><span>      conn.</span><span style="color:#bf616a;">close</span><span>()
</span><span>      </span><span style="color:#b48ead;">if </span><span>post is </span><span style="color:#d08770;">None</span><span>:
</span><span>        </span><span style="color:#bf616a;">abort</span><span>(</span><span style="color:#d08770;">404</span><span>)
</span><span>      </span><span style="color:#b48ead;">return </span><span>post
</span><span>    </span><span style="color:#b48ead;">else</span><span>:
</span><span>      </span><span style="color:#bf616a;">abort</span><span>(</span><span style="color:#d08770;">404</span><span>)
</span></code></pre>
<p>The weakness in the code snippet can be found in the <code>conn.execute</code> as it's susceptible to SQL injection. The <code>post_id</code> can act as a malicious source of which if the <code>post_id</code> is not validated or sanitized, you can append other SQL query operators that would modify the statement to extract sensitive information from other fields. To mitigate against this type of attack, never use the input directly and use prepared statements. Prepared statement is also called parameterized queries which is a coding technique to define the SQL statement first then pass in the parameter to the query later. If a malicious input would be attempted, the input will be treated as a data instead of code.</p>
<h2 id="python-06">Python 06</h2>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>http.server </span><span style="color:#b48ead;">import </span><span>BaseHTTPRequestHandler, HTTPServer
</span><span style="color:#b48ead;">import </span><span>re 
</span><span style="color:#b48ead;">from </span><span>os.path </span><span style="color:#b48ead;">import </span><span>exists
</span><span style="color:#b48ead;">import </span><span>os
</span><span> 
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">MyServer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BaseHTTPRequestHandler</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">do_GET</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>      path = os.</span><span style="color:#bf616a;">getcwd</span><span>()
</span><span>      pattern = </span><span style="color:#b48ead;">r</span><span>&#39;</span><span style="color:#a3be8c;">/</span><span style="color:#96b5b4;">\.\.\/\.\.\/</span><span>&#39;
</span><span>      </span><span style="color:#b48ead;">if </span><span>re.</span><span style="color:#bf616a;">match</span><span>(pattern, </span><span style="color:#bf616a;">self</span><span>.path ):
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_response</span><span>(</span><span style="color:#d08770;">404</span><span>)
</span><span>        </span><span style="color:#b48ead;">return
</span><span>      path += </span><span style="color:#bf616a;">self</span><span>.path
</span><span>      </span><span style="color:#b48ead;">if </span><span>path.</span><span style="color:#bf616a;">endswith</span><span>(&#39;</span><span style="color:#a3be8c;">/</span><span>&#39;):
</span><span>        path+=&#39;</span><span style="color:#a3be8c;">index.html</span><span>&#39;
</span><span>      </span><span style="color:#96b5b4;">print</span><span>(path)
</span><span>      </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">exists</span><span>(path):
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_response</span><span>(</span><span style="color:#d08770;">200</span><span>)
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_header</span><span>(&quot;</span><span style="color:#a3be8c;">Content-type</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">text/html</span><span>&quot;)
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">end_headers</span><span>()
</span><span>        </span><span style="color:#bf616a;">self</span><span>.wfile.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#96b5b4;">open</span><span>(path).</span><span style="color:#bf616a;">read</span><span>().</span><span style="color:#bf616a;">encode</span><span>(&#39;</span><span style="color:#a3be8c;">utf-8</span><span>&#39;))
</span><span>      </span><span style="color:#b48ead;">else</span><span>:
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">send_response</span><span>(</span><span style="color:#d08770;">404</span><span>)
</span><span>          
</span><span style="color:#b48ead;">if </span><span>__name__ == &quot;</span><span style="color:#a3be8c;">__main__</span><span>&quot;:
</span><span>    webServer = </span><span style="color:#bf616a;">HTTPServer</span><span>((&#39;</span><span style="color:#a3be8c;">0.0.0.0</span><span>&#39;, </span><span style="color:#d08770;">1337</span><span>), MyServer)
</span><span>    
</span><span>    </span><span style="color:#b48ead;">try</span><span>:
</span><span>        webServer.</span><span style="color:#bf616a;">serve_forever</span><span>()
</span><span>    </span><span style="color:#b48ead;">except </span><span>KeyboardInterrupt:
</span><span>        </span><span style="color:#b48ead;">pass
</span><span>        
</span><span>    webServer.</span><span style="color:#bf616a;">server_close</span><span>()
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">Server stopped.</span><span>&quot;)
</span></code></pre>
<p>The weakness in this python code can be found in the <code>pattern</code> variable. The regex pattern assigned to the variable is a string filter designed to keep out strings in the URL that contain <code>../../</code>. However, I still don't know how this filtering can be bypassed as I've tried all sorts of combination which includes trying to manipulate the <code>getcwd</code> method.</p>
</article>

  
    
  
  <ul class="tags">
    
      <li><a href='https://johntuyen.com/tags/pentesterlab'>pentesterlab</a></li>
    
  </ul>
  
  
    
</section>
</article>
    <footer>
        <div class="social">
            <ul> 
                 
                <li>
                    <a href="https://github.com/jtuyen"
                       title="Github" rel="me"><i data-feather="github"></i></a>
                </li>
                 
                 
                <li>
                    <a href="https://twitter.com/jtuyen"
                       title="Twitter"
                       rel="me"><i data-feather="twitter"></i></a>
                </li>
                
                
                
                <li>
                    <a href="https://johntuyen.com/atom.xml"
                       title="John Tuyen"><i data-feather="rss"></i></a>
                </li>
            </ul>
        </div>
        <p> © John Tuyen 2024

        
        <br>Powered by <a target="_blank" href="https://getzola.org/">Zola</a>. Theme: <a target="_blank" href="https://github.com/jimmyff/zola-inky">Inky</a>.
        </p>
    </footer>
    <script>
        feather.replace();
    </script> 
    </body>
</html>