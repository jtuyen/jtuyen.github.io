<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible"
      content="IE=edge">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0" />
<meta name="description"
      content="Adventures of Functional Mediocrity" />
<meta name="keywords"
      content="zola, theme, ink, hugo-ink" /> 

<title>John Tuyen | Postman</title>
<meta
  property="og:title"
  content="John Tuyen | Postman"
/>
<meta property="og:type" content="website" />
<meta property="og:url" content="https://johntuyen.com/posts/htb-postman/" />
<meta property="og:description" content="Adventures of Functional Mediocrity" />
<meta property="og:image" content="" />
<meta property="og:image:url" content="" />
<meta property="og:image:secure_url" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Postman" />
<meta name="twitter:description" content="Adventures of Functional Mediocrity" />
<meta property="twitter:image" content="" />

<link rel="alternate"
          type="application/rss+xml"
          title="John Tuyen"
          href="https://johntuyen.com/atom.xml">
    <link rel="preconnect"
          href="https://fonts.googleapis.com">
    <link rel="preconnect"
          href="https://fonts.gstatic.com"
          crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">  -->
    <link href="https://fonts.googleapis.com/css2?family=Andada+Pro&display=swap&family=Playfair+Display"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://johntuyen.com/base.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js"
            integrity="sha512-7x3zila4t2qNycrtZ31HO0NnJr8kg2VI67YLoRSyi9hGhRN66FHYWr7Axa9Y1J9tGYHVBPqIjSE1ogHrJTz51g=="
            crossorigin="anonymous"></script>
</head>

<body>
    <header>
        <a class="site-name"
           href="/">
            <h1>John Tuyen</h1>
        </a>
        <div class="site-description">
            <p>Adventures of Functional Mediocrity</p>
        </div>
        <nav>
            <div class="links"> 
            <a 
                href="https://johntuyen.com/ ">About</a> 
            <a 
                href="https://johntuyen.com/posts/ ">Posts</a> 
            <a 
                href="https://johntuyen.com/gallery/ ">Gallery</a> 
            <a 
                href="https://johntuyen.com/tags/ ">Tags</a> 
            <a 
                href="https://johntuyen.com/search/ ">Search</a> 
            </div>
        </nav>
    </header>
    <article>
    

<section class="post">
  <div class="post-header">
    <div class="meta">
      <div class="date">
        <span class="day">14</span>
        <span class="rest">Mar 20</span>
      </div>
    </div>

    <div class="matter">
      <h1 class="title">Postman </h1>
    </div>
  </div>
    
  <article><ol>
<li>
<p><code>nmap</code> scans show ports 22, 80, 6379 (redis), and 10000 (webmin) are open.</p>
</li>
<li>
<p>Port 80 shows a web page that doesn't show much information besides a basic page with static code.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-port80.png" alt="htb-postman-port80.png" /></p>
</li>
<li>
<p>Moving onto the next port 6379. It's the default port that Redis service uses. Redis is a popular NoSQL database that operates using key and value store. To interface with Redis service, I will need to install <code>redis-tools</code> for the CLI tool.</p>
</li>
<li>
<p>Once <code>redis-tools</code> has been installed, time to interface with the redis server.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>redis-cli -h 10.10.10.160
</span></code></pre>
<p>Checking to see if there are any useful keys value pairs with sensitive information but none was to be found. I figured at this point it's probably some server side exploit to be found. Time to start Googling.</p>
</li>
<li>
<p>I found a couple of exploits on Github that creates a Redis rouge server to run a MODULE command but I couldn't get it working. After manually debugging the code, I finally realize the server doesn't allow MODULE command to be executed. Time to move onto a simpler exploit.</p>
</li>
<li>
<p>This <a href="https://github.com/Avinash-acid/Redis-Server-Exploit">Redis Server Exploit script</a> will fit the job. What this script does is it will manipulate the redis configuration value to upload a public key. It will create a private key on your local machine and append the new key to the redis configuration value using <code>redis-cli</code>.</p>
<p>Here is the <a href="https://maxchadwick.xyz/blog/ssrf-exploits-against-redis">blog post</a> that will go through in detail on how it works.</p>
<p>The only problem with this script is I need to know the the name of a user on the server. We need this information so we could set the Redis’ dir to that user’s .ssh/ directory and set the <code>dbfilename</code> to authorized_keys. This is what happens if you run the script when don't know what the username is:</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-noperm.png" alt="htb-postman-noperm.png" /></p>
<p>Notice how it says &quot;ERR changing directory: no such file or directory&quot;. I need to find a writable location that the redis server has access. This is a trial and error process of figuring out what possible locations I could save my files.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-dir.png" alt="htb-postman-dir.png" /></p>
<p>After Googling where redis server stores the database files (/var/lib/redis), I've managed to succeed with finding write access. We just need to modify our script with the new path.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>cmd4 = cmd1 + &#39; config set dir&#39; + &quot; /var/lib/&quot;+username+&quot;/.ssh/&quot;
</span></code></pre>
</li>
<li>
<p>When you execute the modified script, you should be able to get a low privilege shell as redis user.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-redisscript.png" alt="htb-postman-redisscript.png" /></p>
</li>
<li>
<p>Lurking around, running my linux enumeration scripts, checking to see what this system is about. I found this id_rsa.bak file stored at /opt. Obviously seems like a private key waiting to be cracked.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-idrsabak.png" alt="htb-postman-idrsabak.png" /></p>
</li>
<li>
<p>After Googling around on how to crack a private key, I will have to first convert the key to a format that John The Ripper tool will understand.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/usr/share/john/ssh2john.py id_rsa.bak &gt; id_rsa
</span></code></pre>
</li>
<li>
<p>Time to begin cracking the extracted key using rockyou.txt wordlist.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-johnripper.png" alt="htb-postman-johnripper.png" /></p>
</li>
<li>
<p>Now that we have the password, I'll try and login using the unmodified key.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-connectionclosed.png" alt="htb-postman-connectionclosed.png" /></p>
<p>Access denied. I took a look into /etc/ssh/sshd_config and shows that the user Matt is denied access.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-mattdenied.png" alt="htb-postman-mattdenied.png" /></p>
</li>
<li>
<p>Not too sure what to do next here, I figured maybe I should try the username and password for the Webmin control panel located on port 10000.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-webmin.png" alt="htb-postman-webmin.png" /></p>
</li>
<li>
<p>Now that I'm logged in, the control panel functionality seems limited. No where to execute commands or create cronjobs. I figured webmin has to be exploited.</p>
<p>I found this Webmin 1.90 exploit for metasploit: <a href="https://www.exploit-db.com/exploits/46984">link</a></p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-msf.png" alt="htb-postman-msf.png" /></p>
<p>This module will get you root permissions and easily obtain the user and root flag at the same time.</p>
<p><img src="https://johntuyen.com/posts/htb-postman/htb-postman-rooted.png" alt="htb-postman-rooted.png" /></p>
</li>
</ol>
</article>

  
    
  
  <ul class="tags">
    
      <li><a href='https://johntuyen.com/tags/hackthebox'>hackthebox</a></li>
    
  </ul>
  
  
    
</section>
</article>
    <footer>
        <div class="social">
            <ul> 
                 
                <li>
                    <a href="https://github.com/jtuyen"
                       title="Github" rel="me"><i data-feather="github"></i></a>
                </li>
                 
                 
                <li>
                    <a href="https://twitter.com/jtuyen"
                       title="Twitter"
                       rel="me"><i data-feather="twitter"></i></a>
                </li>
                
                
                
                <li>
                    <a href="https://johntuyen.com/atom.xml"
                       title="John Tuyen"><i data-feather="rss"></i></a>
                </li>
            </ul>
        </div>
        <p> © John Tuyen 2024

        
        <br>Powered by <a target="_blank" href="https://getzola.org/">Zola</a>. Theme: <a target="_blank" href="https://github.com/jimmyff/zola-inky">Inky</a>.
        </p>
    </footer>
    <script>
        feather.replace();
    </script> 
    </body>
</html>